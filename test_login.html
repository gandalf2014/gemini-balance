<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试登录功能</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <h1>Gemini Balance 登录功能测试</h1>
    
    <div class="test-section">
        <h2>测试登录API</h2>
        <p>测试 /admin/login 端点是否正常工作</p>
        
        <div>
            <label>口令: </label>
            <input type="password" id="password" placeholder="输入口令" value="gandalf">
            <button class="btn-primary" onclick="testLogin()">测试登录</button>
        </div>
        
        <div id="login-result" class="result" style="display: none;"></div>
    </div>
    
    <div class="test-section">
        <h2>测试管理界面</h2>
        <p>测试管理界面是否显示登录页面</p>
        
        <button class="btn-success" onclick="openAdminInterface()">打开管理界面</button>
    </div>
    
    <div class="test-section">
        <h2>功能说明</h2>
        <ul>
            <li>✅ 添加了登录界面，包含口令输入框</li>
            <li>✅ 添加了 /admin/login API 端点验证口令</li>
            <li>✅ 正确的口令是 "gandalf"</li>
            <li>✅ 登录成功后显示原有的管理界面</li>
            <li>✅ 添加了登出按钮</li>
            <li>✅ 使用 localStorage 记住登录状态</li>
            <li>✅ 保留了所有原有功能</li>
        </ul>
    </div>

    <script>
        async function testLogin() {
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('login-result');
            
            try {
                const response = await fetch('/admin/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ password })
                });
                
                const data = await response.json();
                
                resultDiv.style.display = 'block';
                if (response.ok && data.success) {
                    resultDiv.style.background = '#d4edda';
                    resultDiv.style.color = '#155724';
                    resultDiv.innerHTML = `
                        <strong>登录成功!</strong><br>
                        Token: ${data.token}<br>
                        Message: ${data.message}
                    `;
                } else {
                    resultDiv.style.background = '#f8d7da';
                    resultDiv.style.color = '#721c24';
                    resultDiv.innerHTML = `
                        <strong>登录失败!</strong><br>
                        Error: ${data.message || '未知错误'}
                    `;
                }
            } catch (error) {
                resultDiv.style.display = 'block';
                resultDiv.style.background = '#f8d7da';
                resultDiv.style.color = '#721c24';
                resultDiv.innerHTML = `
                    <strong>请求失败!</strong><br>
                    Error: ${error.message}
                `;
            }
        }
        
        function openAdminInterface() {
            window.open('/admin', '_blank');
        }
    </script>
</body>
</html>
