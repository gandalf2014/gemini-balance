# Gemini Balance 管理界面登录功能实现

## 功能概述

为 Gemini Balance 后台管理界面添加了口令验证功能，口令为 "gandalf"。只有输入正确口令后才能访问管理界面。

## 实现的功能

### 1. 登录界面
- ✅ 美观的登录页面，包含口令输入框
- ✅ 错误提示显示
- ✅ 响应式设计，适配移动设备

### 2. 后端验证
- ✅ 新增 `/admin/login` API 端点
- ✅ 验证口令是否为 "gandalf"
- ✅ 返回登录token
- ✅ 登录端点不需要管理员权限

### 3. 前端逻辑
- ✅ 页面加载时检查登录状态
- ✅ 登录成功后隐藏登录界面，显示管理界面
- ✅ 使用 localStorage 记住登录状态
- ✅ 登出功能，清除登录状态

### 4. 用户体验
- ✅ 添加了登出按钮（红色，位于导航栏右侧）
- ✅ 登录/登出状态提示消息
- ✅ 保持原有管理界面的所有功能

## 修改的文件

### 1. `src/utils/static.js`
- 修改 `serveAdminInterface()` 函数，添加登录界面HTML
- 修改 `serveAdminJS()` 函数，添加登录相关JavaScript逻辑
- 修改 `serveAdminCSS()` 函数，添加登录界面样式

### 2. `src/handlers/admin.js`
- 添加 `handleAdminLogin()` 函数处理登录请求
- 修改路由逻辑，将登录路由移到权限检查之前

## 技术实现细节

### 登录流程
1. 用户访问 `/admin` 或 `/admin.html`
2. 检查 localStorage 中的登录状态
3. 如果未登录，显示登录界面
4. 用户输入口令 "gandalf" 并提交
5. 前端调用 `/admin/login` API
6. 后端验证口令，返回token
7. 前端保存token到localStorage
8. 隐藏登录界面，显示管理界面

### 登出流程
1. 用户点击登出按钮
2. 清除localStorage中的token
3. 隐藏管理界面，显示登录界面

### 安全考虑
- 口令验证在后端进行
- 使用token机制（虽然简化版本）
- 登录状态本地存储
- 登录API端点独立于其他管理API

## 使用方法

1. 访问管理界面：`http://your-domain/admin`
2. 输入口令：`gandalf`
3. 点击登录按钮
4. 成功后即可使用所有管理功能
5. 点击右上角的"登出"按钮可以退出

## 兼容性

- ✅ 完全保留原有功能
- ✅ 不删除任何现有代码
- ✅ 向后兼容
- ✅ 响应式设计

## 测试

可以使用 `test_login.html` 文件测试登录功能：
1. 打开测试页面
2. 测试登录API
3. 测试管理界面访问

## 口令信息

**管理员口令：** `gandalf`

请妥善保管此口令，建议在生产环境中使用更复杂的口令。
